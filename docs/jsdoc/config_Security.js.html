<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: config/Security.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: config/Security.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import bcrypt from 'bcrypt'
import cryptoJs from 'crypto-js'
import jwt from 'jsonwebtoken'

/**
 * Security class
 */
class Security {
    /**
     * Creates a hash with BCrypt
     * @param {String} string String to hash
     * @returns {Promise} Hash or error
     */
    static hash(string) {
        return bcrypt.hash(string, 10)
    }

    /**
     * Compares two strings matching their BCrypt hash
     * @param {String} string String to encrypt
     * @param {String} stringToMatch Hash to match
     * @returns {Promise} Comparison result or error
     */
    static compareHash(string, stringToMatch) {
        return bcrypt.compare(string, stringToMatch)
    }

    /**
     * Encrypts a string with AES algorythm
     * @param {String} string String to encrypt
     * @returns {String} Encrypted string
     */
    static encrypt(string) {
        const { key, iv } = Security.generateAesKeys()
        return cryptoJs.AES.encrypt(string, key, { iv }).toString()
    }

    /**
     * Decrypts a string from AES algorythm
     * @param {String} string String to decrypt
     * @returns {String} Decrypted string
     */
    static decrypt(string) {
        const { key, iv } = Security.generateAesKeys()
        return cryptoJs.AES.decrypt(string, key, { iv }).toString(cryptoJs.enc.Utf8)
    }

    /**
     * Returns { key, iv } for AES encryption
     * @returns {{String, String}} { key, iv }
     */
    static generateAesKeys() {
        const aesString = process.env.AES_BASE_STRING
        let aesKey = ''
        let aesIv = ''
        let i = 0

        while (aesKey.length &lt; 32 &amp;&amp; aesIv.length &lt; 32) {
            aesKey += i % 2 === 0 ? `${aesString.charAt(i + 2) !== '' ? aesString.charAt(i + 2) : (3 * i)}` : i
            aesIv += i % 2 === 0 ? `${aesString.charAt(i + 3) !== '' ? aesString.charAt(i + 3) : (2 * i)}` : 1+i
            i++
        }

        const key = cryptoJs.enc.Hex.parse(aesKey)
        const iv = cryptoJs.enc.Hex.parse(aesIv)
        return { key, iv }
    }
    
    /**
     * Creates a JSON web token
     * @param {String} userId User Id
     * @returns {String} JWT
     */
    static createJwt(userId) {
        return jwt.sign({ userId }, process.env.TOKEN_SECRET, { expiresIn: '24h' })
    }

    /**
     * Verifies the JSON web token
     * @param {String} token JWT
     * @returns {String} UserId
     */
    static decodeJwt(token) {
        const decodedToken = jwt.verify(token, process.env.TOKEN_SECRET)
        return decodedToken.userId
    }
}

export default Security</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Models_Sauce.html">Models/Sauce</a></li><li><a href="module-Models_User.html">Models/User</a></li><li><a href="module-Routes_Sauce.html">Routes/Sauce</a></li><li><a href="module-Routes_User.html">Routes/User</a></li></ul><h3>Classes</h3><ul><li><a href="Database.html">Database</a></li><li><a href="SauceController.html">SauceController</a></li><li><a href="Security.html">Security</a></li><li><a href="UserController.html">UserController</a></li><li><a href="Validator.html">Validator</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu Jun 03 2021 19:13:43 GMT+0200 (heure d’été d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
